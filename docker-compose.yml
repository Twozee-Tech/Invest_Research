services:
  # Ghostfolio: external instance at 192.168.0.12:3333
  # llama-swap: external instance at 192.168.0.169:8080/v1
  # Both services are already running - orchestrator just connects to them.

  orchestrator:
    build:
      context: .
      dockerfile: orchestrator/Dockerfile
    ports:
      - "8501:8501"    # Streamlit dashboard
    environment:
      GHOSTFOLIO_URL: ${GHOSTFOLIO_URL:-http://192.168.0.12:3333}
      GHOSTFOLIO_ACCESS_TOKEN: ${GHOSTFOLIO_ACCESS_TOKEN:?Set GHOSTFOLIO_ACCESS_TOKEN in .env}
      LLM_BASE_URL: ${LLM_BASE_URL:-http://192.168.0.169:8080/v1}
      INITIAL_BUDGET: ${INITIAL_BUDGET:-10000}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 5
